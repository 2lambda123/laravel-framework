<?php namespace Illuminate\Database\Console\Migrations; use Illuminate\Console\Command; use Symfony\Component\Console\Input\InputOption; class RefreshCommand extends Command { protected $name = 'migrate:refresh'; protected $description = 'Reset and re-run all migrations'; public function fire() { $database = $this->input->getOption('database'); $this->call('migrate:reset', array('--database' => $database)); $this->call('migrate', array('--database' => $database)); if ($this->needsSeeding()) { $this->runSeeder($database); } } protected function needsSeeding() { return $this->option('seed') || $this->option('seeder'); } protected function runSeeder($database) { $class = $this->option('seeder') ?: 'DatabaseSeeder'; $this->call('db:seed', array('--database' => $database, '--class' => $class)); } protected function getOptions() { return array( array('database', null, InputOption::VALUE_OPTIONAL, 'The database connection to use.'), array('seed', null, InputOption::VALUE_NONE, 'Indicates if the seed task should be re-run.'), array('seeder', null, InputOption::VALUE_OPTIONAL, 'The class name of the root seeder.'), ); } }
