<?php namespace Illuminate\Foundation\Console; use Illuminate\Console\Command; class TinkerCommand extends Command { protected $name = 'tinker'; protected $description = "Interact with your application"; public function fire() { if ($this->supportsBoris()) { $this->runBorisShell(); } else { $this->comment('Full REPL not supported. Falling back to simple shell.'); $this->runPlainShell(); } } protected function runBorisShell() { $this->setupBorisErrorHandling(); with(new \Boris\Boris('> '))->start(); } protected function setupBorisErrorHandling() { restore_error_handler(); restore_exception_handler(); $this->laravel->make('artisan')->setCatchExceptions(false); $this->laravel->error(function() { return ''; }); } protected function runPlainShell() { $input = $this->prompt(); while ($input != 'quit') { try { if (starts_with($input, 'dump ')) { $input = 'var_dump('.substr($input, 5).');'; } eval($input); } catch (\Exception $e) { $this->error($e->getMessage()); } $input = $this->prompt(); } } protected function prompt() { $dialog = $this->getHelperSet()->get('dialog'); return $dialog->ask($this->output, "<info>></info>", null); } protected function supportsBoris() { return extension_loaded('readline') && extension_loaded('posix') && extension_loaded('pcntl'); } }
