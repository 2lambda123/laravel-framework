<?php namespace Illuminate\Foundation\Console; use Illuminate\Console\Command; use Symfony\Component\Finder\Finder; use Illuminate\Foundation\AssetPublisher; use Symfony\Component\Console\Input\InputOption; use Symfony\Component\Console\Input\InputArgument; class AssetPublishCommand extends Command { protected $name = 'asset:publish'; protected $description = "Publish a package's assets to the public directory"; protected $assets; public function __construct(AssetPublisher $assets) { parent::__construct(); $this->assets = $assets; } public function fire() { foreach ($this->getPackages() as $package) { $this->publishAssets($package); } } protected function publishAssets($package) { if ( ! is_null($path = $this->getPath())) { $this->assets->publish($package, $path); } else { $this->assets->publishPackage($package); } $this->output->writeln('<info>Assets published for package:</info> '.$package); } protected function getPackages() { if ( ! is_null($package = $this->input->getArgument('package'))) { return array($package); } elseif ( ! is_null($bench = $this->input->getOption('bench'))) { return array($bench); } return $this->findAllAssetPackages(); } protected function findAllAssetPackages() { $vendor = $this->laravel['path.base'].'/vendor'; $packages = array(); foreach (Finder::create()->directories()->in($vendor)->name('public')->depth('< 3') as $package) { $packages[] = $package->getRelativePath(); } return $packages; } protected function getPath() { $path = $this->input->getOption('path'); if ( ! is_null($path)) { return $this->laravel['path.base'].'/'.$path; } $bench = $this->input->getOption('bench'); if ( ! is_null($bench)) { return $this->laravel['path.base']."/workbench/{$bench}/public"; } } protected function getArguments() { return array( array('package', InputArgument::OPTIONAL, 'The name of package being published.'), ); } protected function getOptions() { return array( array('bench', null, InputOption::VALUE_OPTIONAL, 'The name of the workbench to publish.', null), array('path', null, InputOption::VALUE_OPTIONAL, 'The path to the asset files.', null), ); } }
